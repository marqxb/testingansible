- name: Reboot Needy Servers
hosts: all
become: true
tasks:
- name: Check if reboot exists
stat:
path: /var/run/reboot-required
register: stat_result
- name: Check if reboot exists
debug:
msg: 'Reboot file found'
when: stat_result.stat.exists
- name: See if it's missing
debug:
msg: 'No Reboot'
when: not stat_result.stat.exists
- name: Reboot host and wait for restart if reboot found
reboot:
msg: 'Reboot initiated'
connect_timeout: 5
reboot_timeout: 600
pre_reboot_delay: 0
post_reboot_delay: 30
test_command: whoami
msg: "Reboot complete "
when: stat_result.stat.exists
